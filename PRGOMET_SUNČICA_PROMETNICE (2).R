# igramo se s čitanjem datoteka, ne treba nam sve ovo...
#ulazni_dir = "put/do/direktorija"
#load(paste(ulazni_dir, "prometnice.RData", sep="/"))

# ako ste već u radnom direktoriju
#load("prometnice.Rda")
install.packages("arrow")
library(arrow)
load("C:/Users/1/Desktop/rudarenjeFiles/prometnice.RDa")

vozila <- read.csv("C:/Users/1/Desktop/rudarenjeFiles/fcd_2085.csv.1")

# provjerite što ste učitali
ls()
# [1] "a"           "A"           "aa"          "B"           "br"          "dose"        "f"          
# [8] "imena"       "len"         "lista"       "lokacije"    "mjerenja"    "niz"         "novi"       
# [15] "osobe"       "palcevanje"  "podatci"     "polje"       "postaja"     "prezimena"   "razdioba"   
# [22] "sluc"        "sudionici"   "sudionici2"  "sudionici3"  "supp"        "tezina"      "ToothGrowth"
# [29] "ucenici1."   "ucenici2."   "ucenici3."   "udalj"       "vector1"     "vector2"     "visina"     
# [36] "vozila"      "vrem_serija" "x"           "y"  


# provjeriti dimenzionalnost podataka
# razumijemo li strukturu?
prometnice<-aa
dim(prometnice)
#[1] 22668     3
ncol(prometnice)
#[1] 3
nrow(prometnice)
#[1] 22668
str(prometnice[1,])
# Classes ‘tbl_df’, ‘tbl’ and 'data.frame':	1 obs. of  3 variables:
#   $ id     : chr "1005318956_0_0"
# $ shape  : list<list<double>> [1:1] 
# ..$ : list<double> [1:5] 
# .. ..$ : num  5798 4431
# .. ..$ : num  5795 4431
# .. ..$ : num  5793 4430
# .. ..$ : num  5792 4429
# .. ..$ : num  5791 4426
# .. ..@ ptype: num 
# ..@ ptype: list<double> [1:0] 
# list()
# .. ..@ ptype: num 
# $ duljina: num 9.47

# obratite pozornost na listu lista
# riječ je  o poligonu koji spaja dvije prometnice
# ako uzmemo prvi i zadnji uređeni par to su vrhovi grafa koji imaju više od jednog brida
# možete li nacrtati te prometnice? (za provjeru vidite sliku koju sam ja dao)

# x=c()
# y=c()
# 
# prometnice[1,2]
# print("---")
#a<-prometnice[[2]][[1]]
#a
#prometnice[[2]]
# b<-prometnice[[2]][[1]][1]
# b
# b[[1]][2]

x<-c()
y<-c()

for(i in 1:nrow(prometnice)){
  for(j in 1:length(prometnice[[2]][[i]])){
    a<-prometnice[[2]][[i]][j] #fiksiran 2. stupac
    x=append(x,a[[1]][1])
    y=append(y,a[[1]][2])
    
  }
}
x
# [1] 5797.83 5795.18 5793.18 5791.83 5791.12 5797.83 5793.86 5791.21 5789.88 5789.88 5793.05 5793.05
# [13] 5793.88 5795.52 5797.99 5793.05 5791.12 5787.94 5789.88 5787.94 5789.01 5790.25 5790.25 5791.05
# [25] 5794.04 5797.99 5450.02 5449.19 5448.38 5447.59 5446.82 5506.44 5505.55 5504.73 5503.96 5503.24
# [37] 3320.66 3318.91 3317.44 3315.75 3313.38 3320.66 3318.85 3318.36 3319.19 3321.33 3321.90 3319.30
# [49] 3317.02 3315.04 3313.38 3315.21 3316.31 3317.70 3319.37 3321.33 3343.71 3342.46 3340.81 3338.76
# [61] 3336.32 3343.71 3338.13 3341.05 3346.70 3341.05 3342.06 3341.61 3339.70 3336.32 3335.23 3337.33
# [73] 3338.51 3338.78 3338.13 3335.23 3338.98 3342.15 3344.72 3346.70 3385.65 3385.12 3384.53 3383.83
# [85] 3383.00 3385.65 3385.86 3386.50 3386.50 3387.76 3391.35 3396.62 3396.88 3394.45 3392.82 3392.00
# [97] 3391.99 3396.88 3391.55 3387.46 3384.61 3383.00 3386.10 3387.25 3389.39 3392.51 3396.62 3386.10
# [109] 3386.90 3387.55 3388.15 3388.82 3289.71 3287.19 3289.71 3288.55 3286.53 3283.67 3279.95 3284.06
# [121] 3284.21 3283.57 3282.15 3279.95 3284.06 3286.64 3463.33 3461.85 3460.09 3458.04 3455.71 3463.33
# [133] 3462.18 3462.88 3465.45 3469.87 3471.34 3469.32 3468.26 3468.14 3468.99 3471.34 3455.71 3454.24
# [145] 3469.87 3454.24 3457.90 3459.91 3459.91 3461.10 3463.86 3466.16 2601.37 2599.49 2597.57 2595.62
# [157] 2593.63 2601.37 2599.10 2598.08 2598.32 2599.82 2602.12 2601.39 2601.43 2602.23 2603.81 2602.12
# [169] 2593.63 2591.33 2599.82 2591.33 2594.54 2597.69 2600.78 2603.81 2561.02 2550.61 2561.02 2558.64
# [181] 2557.80 2558.48 2560.68 2563.02 2561.61 2561.18 2561.72 2563.23 2563.02 2560.03 2556.97 2553.83
# [193] 2550.61 2552.68 2554.75 2556.77 2558.75 2560.68 2552.68 2563.23 2634.30 2632.27 2630.26 2628.27
# [205] 2626.29 2634.30 2623.85 2634.30 2631.89 2631.03 2631.72 2633.96 2636.29 2634.86 2634.42 2634.96
# [217] 2636.50 2636.29 2626.29 2636.29 2633.25 2630.16 2627.02 2623.85 2626.06 2628.08 2630.07 2632.03
# [229] 2633.96 2626.06 2636.50 2626.06 2628.47 2629.31 2628.59 2626.29 2624.00 2625.45 2625.92 2625.38
# [241] 2623.85 2624.00 2633.96 2624.00 2627.08 2630.19 2633.33 2636.50 2682.64 2680.62 2678.62 2676.66
# [253] 2674.73 2682.64 2672.12 2674.30 2684.84 2674.30 2676.75 2677.64 2676.96 2674.73 2672.40 2673.81
# [265] 2674.24 2673.68 2672.12 2672.40 2675.43 2678.52 2681.65 2684.84 2660.13 2658.12 2656.13 2654.17
# [277] 2652.24 2660.13 2649.66 2660.13 2657.72 2656.86 2657.54 2659.76 2662.10 2660.67 2660.24 2660.80
# [289] 2662.35 2662.10 2652.24 2662.10 2659.07 2655.98 2652.85 2649.66 2651.85 2653.88 2655.87 2657.83
# [301] 2659.76 2651.85 2662.35 2651.85 2654.28 2655.16 2654.48 2652.24 2649.90 2651.33 2651.77 2651.21
# [313] 2649.66 2649.90 2659.76 2649.90 2652.95 2656.04 2659.17 2662.35 2719.78 2717.98 2716.08 2714.09
# [325] 2712.00 2719.78 2717.44 2715.05 2712.57 2709.95 2719.78 2717.82 2717.36 2718.41 2720.97 2722.90
# [337] 2721.29 2720.66 2720.98 2722.28 2722.90 2712.00 2722.90 2719.71 2716.49 2713.23 2709.95 2712.16
# [349] 2714.38 2716.59 2718.78 2720.97 2712.16 2714.83 2717.41 2719.89 2722.28 2712.16 2714.65 2715.46
# [361] 2714.57 2712.00 2709.71 2711.39 2711.99 2711.51 2709.95 2709.71 2720.97 2709.71 2713.10 2716.32
# [373] 2719.38 2722.28 2608.62 2606.72 2605.02 2603.54 2602.25 2608.62 2598.26 2608.62 2606.93 2606.34
# [385] 2606.84 2608.45 2610.74 2609.29 2608.82 2609.34 2610.85 2610.74 2602.25 2610.74 2607.99 2604.53
# [397] 2601.06 2598.26 2600.46 2602.48 2604.49 2606.48 2608.45 2600.46 2610.85 2600.46 2602.17 2603.20
# [409] 2603.31 2602.25 2599.96 2600.73 2600.70 2599.87 2598.26 2599.96 2608.45 2599.96 2602.26 2605.29
# [421] 2608.37 2610.85 2818.56 2816.27 2813.38 2809.88 2805.77 2818.56 2815.89 2812.10 2808.18 2805.10
# [433] 2818.56 2816.60 2816.20 2817.37 2820.10 2821.69 2820.00 2819.22 2819.37 2820.44 2821.69 2805.77
# [445] 2821.69 2817.49 2812.73 2808.30 2805.10 2806.67 2809.51 2812.70 2816.23 2820.10 2806.67 2809.80
# [457] 2813.83 2817.72 2820.44 2806.67 2809.37 2810.13 2808.92 2805.77 2804.18 2806.12 2806.92 2806.58
# [469] 2805.10 2804.18 2820.10 2804.18 2808.39 2813.22 2817.60 2820.44 2586.56 2584.49 2582.46 2580.47
# [481] 2578.51 2586.56 2584.10 2583.24 2583.98 2586.31 2588.59 2587.12 2586.65 2587.19 2588.75 2588.59
# [493] 2578.51 2576.22 2586.31 2576.22 2579.28 2582.38 2585.54 2588.75 5517.85 5515.39 5513.43 5511.97
# [505] 5511.01 5517.85 5504.36 5505.51 5518.93 5505.51 5508.74 5509.91 5509.91 5510.74 5511.49 5511.01
# [517] 5507.91 5508.25 5507.77 5506.47 5504.36 5507.91 5509.46 5511.81 5514.96 5518.93 5507.63 5493.36
# [529] 5507.63 5503.93 5502.35 5502.35 5501.40 5500.04 5499.86 5503.05 5503.16 5504.03 5505.65 5508.03
# [541] 5503.05 5502.14 5500.22 5497.29 5493.36 5493.74 5496.22 5498.07 5499.28 5499.86 5493.74 5508.03
# [553] 5704.50 5702.04 5700.22 5699.06 5698.54 5704.50 5690.13 5690.32 5704.70 5690.32 5694.14 5696.78
# [565] 5698.25 5698.54 5695.35 5695.16 5694.23 5692.55 5690.13 5695.35 5696.16 5697.98 5700.83 5704.70
# [577] 5841.30 5842.45 5842.80 5842.35 5841.10 5700.82 5686.46 5700.82 5697.04 5694.42 5692.97 5692.68
# [589] 5695.87 5696.05 5696.98 5698.65 5701.06 5695.87 5695.06 5693.22 5690.36 5686.46 5686.70 5689.18
# [601] 5691.00 5692.16 5692.68 5686.70 5701.06 5643.58 5642.44 5642.10 5642.56 5643.82 5747.80 5748.94
# [613] 5749.28 5748.82 5747.56 5688.66 5680.90 5688.66 5686.09 5684.27 5684.27 5683.20 5679.98 5676.44
# [625] 5678.28 5680.50 5682.52 5684.34 5685.95 5678.28 5681.17 5682.58 5682.49 5680.90 5678.21 5679.23
# [637] 5679.27 5678.34 5676.44 5678.21 5685.95 5644.64 5644.85 5645.40 5646.30 5647.54 5822.64 5831.95
# [649] 5822.64 5825.34 5827.24 5828.33 5828.62 5825.43 5825.93 5827.18 5829.18 5831.95 5626.58 5635.93
# [661] 5626.58 5629.30 5631.22 5632.32 5632.62 5629.43 5629.91 5631.16 5633.16 5635.93 5396.09 5395.78
# [673] 5396.05 5396.28 5413.87 5412.86 5412.16 5411.47 5410.48 5410.58 5411.59 5412.29 5413.02 5414.07
# [685] 5410.58 5413.41 5414.33 5413.36 5410.48 5562.95 5548.62 5562.95 5559.15 5557.51 5557.51 5556.53
# [697] 5555.08 5554.82 5558.01 5558.18 5559.09 5560.76 5563.18 5558.01 5557.18 5555.34 5552.48 5548.62
# [709] 5548.83 5551.29 5553.11 5554.29 5554.82 5548.83 5563.18 5202.20 5201.62 5200.39 5198.51 5195.97
# [721] 5209.85 5207.68 5206.22 5205.46 5205.39 5209.85 5195.97 5164.89 5156.20 5164.89 5162.42 5160.83
# [733] 5160.11 5160.27 5163.22 5162.35 5160.89 5158.84 5156.20 5105.17 5105.44 5105.66 5105.84 5105.96
# [745] 1788.47 1789.16 1789.13 1788.40 1786.97 6348.81 6350.05 6350.94 6351.49 6351.69 2009.30 2009.60
# [757] 2010.19 2010.43 2014.67 2014.38 2013.74 2013.46 2012.82 2012.53 1962.85 1965.06 1966.72 1968.38
# [769] 1970.61 1962.85 1964.83 1965.98 1967.13 1969.13 1961.32 1963.31 1964.47 1965.63 1967.65 2529.98
# [781] 2526.31 2523.02 2520.12 2517.60 2529.98 2511.64 2529.98 2525.44 2524.23 2524.23 2522.80 2522.05
# [793] 2523.20 2526.16 2525.50 2525.93 2527.45 2530.07 2526.16 2524.39 2522.15 2519.78 2517.60 2526.16
# [805] 2523.87 2521.11 2521.11 2520.23 2515.93 2511.64 2511.65 2515.62 2518.87 2521.39 2523.20 2511.65
# [817] 2530.07 2511.65 2516.75 2518.09 2518.09 2519.44 2519.72 2517.60 2514.88 2517.02 2519.31 2521.47
# [829] 2523.20 2514.88 2517.77 2520.15 2520.15 2521.74 2526.07 2530.07 2647.55 2648.72 2649.61 2650.22
# [841] 2650.55 3061.60 3062.51 3063.34 3064.10 3064.78 2720.20 2706.55 2720.20 2716.19 2714.02 2714.02
# [853] 2712.94 2710.46 2708.76 2711.71 2712.82 2714.42 2716.50 2719.06 2711.71 2712.40 2711.76 2709.82
# [865] 2706.55 2705.49 2707.55 2708.78 2709.18 2708.76 2705.49 2719.06 2042.75 2039.27 2037.88 2038.59
# [877] 2041.39 2042.75 2034.29 2019.79 2004.44 1993.43 2042.75 2037.84 2035.94 2035.94 2034.29 2032.11
# [889] 2031.28 2037.68 2038.11 2039.18 2040.88 2043.21 2037.68 2037.46 2037.22 2038.14 2041.39 2034.48
# [901] 2034.37 2034.39 2035.56 2038.92 2034.48 2033.30 2033.30 2031.22 2022.03 2008.64 1992.76 1994.60
# [913] 2009.33 2019.83 2026.07 2028.08 1993.80 2006.55 2021.74 2035.31 2043.21 1993.00 2005.00 2013.68
# [925] 1993.00 1994.06 1994.35 1993.92 1992.76 2013.68 2018.65 2030.95 2038.92 2031.35 2028.90 2021.77
# [937] 2009.94 1993.43 2031.35 2028.08 2034.54 2031.28 2034.54 2034.63 2034.54 2034.68 2035.26 2034.63
# [949] 2034.71 2036.21 2039.04 2043.21 2035.26 2035.46 2036.87 2038.92 2039.05 2040.21 2041.28 2042.41
# [961] 2043.75 2157.72 2157.81 2159.16 2159.36 3730.81 3729.89 3729.32 3728.87 3728.29 3727.70 3726.76
# [973] 3726.18 3725.71 3725.12 3727.70 3726.12 3725.05 3725.05 3723.36 3719.42 3714.29 3714.88 3717.29
# [985] 3719.19 3720.59 3721.49 3714.88 3719.82 3723.18 3724.94 3725.12 3718.79 3718.81 3718.06 3716.56
# [997] 3714.29 3718.79 3719.41 3719.90
# [ reached getOption("max.print") -- omitted 164299 entries ]

plot(x,y,type="l")
# length(x)
# length(y)


# možete li odbaciti bridove duljine manje od N tako da graf ostane povezan? (koje ne možete odbaciti?)


# provjerimo i podatke o vozilima
dim(vozila)
#[1] 44383114        6
head(vozila)
# id       x       y speed          lane time
# 1 1006_1.0 1817.26 4578.97 15.21   4215595#1_0    0
# 2  104_2.0 4689.78 1069.87  5.39  -4926209#1_0    0
# 3 1072_3.0 5721.04  839.84  5.65   317312606_1    0
# 4 1076_1.0 5233.23 1146.54 16.55 631925372#0_1    0
# 5 1086_1.0 4289.52 2233.03  9.25   554991019_0    0
# 6 1087_2.0 4295.61 2284.15  9.25   554991019_0    0
View(vozila)


# možete li odabrati neko vozilo i nacrtati njegovu putanju?
#odaberemo li npr prvo vozilo iz skupa podataka
auto<-vozila[1,1]
traka<-vozila[1,5]
traka
#[1] "4215595#1_0"

koord<-c()
for(k in 1:nrow(prometnice)){
  if(prometnice[[1]][[k]]==traka){
    koord=append(koord,prometnice[[2]][[k]])
  }
  
}
koord
# <list<double>[6]>
#   [[1]]
# [1] 1796.51 4595.28
# 
# [[2]]
# [1] 1802.52 4589.89
# 
# [[3]]
# [1] 1878.50 4552.07
# 
# [[4]]
# [1] 1884.82 4550.66
# 
# [[5]]
# [1] 1893.96 4550.42
# 
# [[6]]
# [1] 1896.24 4550.61

niz1<-c()
niz2<-c()
for(j in 1:length(koord)){
  a<-koord[[j]]
  niz1=append(niz1,a[1])
  niz2=append(niz2,a[2])
  
} 

plot(niz1,niz2)

View(vozila)



# možete li smanjiti skup podataka?
# primjerice: smanjite vremenski rapson ili odaberite svako deseto vozilo?
nrow(vozila)
svaki_10<-vozila[seq(1, nrow(vozila),10),]


# možete li odabrati odabrati traku i prebrojati vozila u njoj?
traka<-vozila[sample(1:nrow(vozila),1),5]
traka
#[1] "-4395933#7_0"
novi<-vozila[vozila$lane==traka,c("id")]
novi
length(novi)
#[1] 2671


# možete li izračunati gustoču vozila na nekoj prometnici? (broj vozila u odnosu na duljinu trake)

(length(novi))/(prometnice$duljina[prometnice$id==traka])

# možete li prikazati prometnice s najgušćim proemtom?

# mala pomoć:
a <- unlist(prometnice[1,2])
a
plot(a[c(TRUE, FALSE)], a[c(FALSE, TRUE)], type="l")
# znate li što smo ovdje nacrtali?

# uzmite dva vozila i provjerite kako se ponašaju, postavite neku hipotezu
# - vozila u istoj traci ponašat će se slično
# - vozila u istom razdoblju u danu ponašat će se slično

# provjerite korelaciju i standardnu devijaciju - usporedte ih u nekoj traci ili u nekom vremenskom trenutku
brzine_na_prometnici_traka<-vozila[vozila$lane==traka,c("speed")]
brzine_na_prometnici_traka
time_na_prometnici_traka<-vozila[vozila$lane==traka,c("time")]
sd(brzine_na_prometnici_traka)
cor(brzine_na_prometnici_traka,time_na_prometnici_traka)

# možete korisiti druge biblioteke za crtanje 
# (po želji - na ovome se može izgubiti mnogo vremena, a da se malo doprinese analizi)
# leaflet, ggplot (ggmap)... usp. "Geocomputation with R", https://geocompr.robinlovelace.net/adv-map.html


#2. Nacrtajte putanju jednog vozila.
#za 1. vozilo
prometnice[1,2]
a <- unlist(prometnice[1,2])
a
xkoord<-c()
ykoord<-c()
for(i in 1:length(a)){
  if(i%%2==0){
    xkoord=append(xkoord,a[i])
  }
  else{
    ykoord=append(ykoord,a[i])
  }
}
xkoord
ykoord
plot(xkoord,ykoord,"l")

#3. Poredajte prometnice po duljini ili krivudavosti (ili nekakav drugi parametar za ad-hoc određivanje važnosti prometnice)
#duljina

install.packages("data.table")
library("data.table")
poredani<-setorder(prometnice,cols="duljina")